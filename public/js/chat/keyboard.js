var Stamp = require('./stamp')

module.exports = class Keyboard {
  constructor(dcb) {
    this.loadLayer(0);
    this.keyCallback = dcb;

    $('.key').on('click', function(e) {
      var keyidx = $(e.target).attr('data-keyidx')
      if (!keyidx) { return; }
      var layer = KeyboardMap[this.currentLayer];
      var stamp = layer[keyidx]
      this.keyCallback(stamp)

    }.bind(this));
  }

  loadLayer(l) {
    this.currentLayer = l;
    var layer = KeyboardMap[l];
    for (let c = 0; c < layer.length; c++) {
      let stamp = layer[c];
      $($('.keyboard .key').get(c)).html(stamp.char);
    }
  }
}

const KeyboardMap = [
  // Layer 0 - QWERTY
  [
    new Stamp('q', 5, 7, ['.....', '.##.#', '#..##', '#...#', '.####', '....#', '....#']),
    new Stamp('w', 5, 7, ['.....', '.....', '#...#', '#...#', '#.#.#', '#.#.#', '.####']),
    new Stamp('e', 5, 7, ['.....', '.....', '.###.', '#...#', '#####', '#....', '.####']),
    new Stamp('r', 5, 7, ['.....', '.....', '#.##.', '##..#', '#....', '#....', '#....']),
    new Stamp('t', 3, 7, ['.#.', '.#.', '###', '.#.', '.#.', '.#.', '..#']),
    new Stamp('y', 5, 7, ['.....', '#...#', '#...#', '#...#', '.####', '....#', '####.']),
    new Stamp('u', 5, 7, ['.....', '.....', '#...#', '#...#', '#...#', '#...#', '.####']),
    new Stamp('i', 1, 7, ['#', '.', '#', '#', '#', '#', '#']),
    new Stamp('o', 5, 7, ['.....', '.....', '.###.', '#...#', '#...#', '#...#', '.###.']),
    new Stamp('p', 5, 7, ['.....', '#.##.', '##..#', '#...#', '####.', '#....', '#....']),
    new Stamp('a', 5, 7, ['.....', '.....', '.###.', '....#', '.####', '#...#', '.####']),
    new Stamp('s', 5, 7, ['.....', '.....', '.####', '#....', '.###.', '....#', '####.']),
    new Stamp('d', 5, 7, ['....#', '....#', '.##.#', '#..##', '#...#', '#...#', '.####']),
    new Stamp('f', 4, 7, ['..##', '.#..', '####', '.#..', '.#..', '.#..', '.#..']),
    new Stamp('g', 5, 7, ['.....', '.####', '#...#', '#...#', '.####', '....#', '####.']),
    new Stamp('h', 5, 7, ['#....', '#....', '#.##.', '##..#', '#...#', '#...#', '#...#']),
    new Stamp('j', 2, 7, ['.#', '..', '.#', '.#', '.#', '.#', '#.']),
    new Stamp('k', 5, 7, ['#....', '#....', '#...#', '#..#.', '###..', '#..#.', '#...#']),
    new Stamp('l', 2, 7, ['#.', '#.', '#.', '#.', '#.', '#.', '.#']),
    new Stamp('!', 1, 7, ['#', '#', '#', '#', '#', '.', '#']),
    new Stamp('z', 5, 7, ['.....', '.....', '#####', '...#.', '..#..', '.#...', '#####']),
    new Stamp('x', 5, 7, ['.....', '.....', '#...#', '.#.#.', '..#..', '.#.#.', '#...#']),
    new Stamp('c', 5, 7, ['.....', '.....', '.###.', '#...#', '#....', '#...#', '.###.']),
    new Stamp('v', 5, 7, ['.....', '.....', '#...#', '#...#', '#...#', '.#.#.', '..#..']),
    new Stamp('b', 5, 7, ['#....', '#....', '#.##.', '##..#', '#...#', '#...#', '.###.']),
    new Stamp('n', 5, 7, ['.....', '.....', '####.', '#...#', '#...#', '#...#', '#...#']),
    new Stamp('m', 5, 7, ['.....', '.....', '##.#.', '#.#.#', '#.#.#', '#...#', '#...#']),
    new Stamp(',', 2, 7, ['..', '..', '..', '..', '..', '.#', '#.']),
    new Stamp('.', 1, 7, ['.', '.', '.', '.', '.', '.', '#']),
    new Stamp('?', 5, 7, ['.###.', '#...#', '....#', '...#.', '..#..', '....', '..#..']),
    new Stamp('_', 3, 7, ['...', '...', '...', '...', '...', '...', '...']),
  ]
]
